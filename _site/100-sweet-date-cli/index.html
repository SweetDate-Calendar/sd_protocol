<h1 id="sweetdate-cli">SweetDate CLI</h1>

<p>The <strong>SweetDate CLI</strong> is a developer tool for working with the <strong>SweetDate Implementation Protocol (SDIP)</strong>.<br />
It takes the protocol definition (provided as JSON) and:</p>

<ul>
  <li>Generates starter templates for implementing client libraries in different programming languages.</li>
  <li>Runs automated conformance tests to verify correct protocol behavior.</li>
</ul>

<hr />

<h2 id="purpose">Purpose</h2>

<p>The SweetDate CLI ensures <strong>secure, consistent, and verifiable implementations</strong> of client libraries.</p>

<ul>
  <li>It scaffolds a complete set of protocol commands for each supported language.</li>
  <li>It provides a <strong>Universal Conformance Driver</strong> to test that implementations behave exactly as expected.</li>
</ul>

<p>This guarantees that client libraries across Ruby, Elixir, PHP, and future languages stay aligned with the SweetDate protocol — both in <strong>structure</strong> and in <strong>runtime behavior</strong>.</p>

<hr />

<h2 id="flow">Flow</h2>

<p><img src="/sd_protocol/assets/images/CLI-Flow.svg" alt="Development diagram" /></p>

<ul>
  <li><strong>Input:</strong> A JSON specification of the SDIP (SweetDate Implementation Protocol).</li>
  <li><strong>Output:</strong> Language-specific scaffolding code (Ruby, Elixir, PHP, …).</li>
  <li><strong>Verification:</strong> Optional conformance testing against a live SweetDate instance.</li>
</ul>

<hr />

<h2 id="configuration">Configuration</h2>

<p>The CLI reads a configuration file (<code class="language-plaintext highlighter-rouge">sd.config.json</code>) in the project root.<br />
This file defines the protocol location, output folders, and optional test configuration.</p>

<p><strong>Example:</strong></p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"protocol"</span><span class="p">:</span><span class="w"> </span><span class="s2">"protocol-version-01/protocol.json"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"targets"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"ruby"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nl">"output"</span><span class="p">:</span><span class="w"> </span><span class="s2">"out/ruby"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nl">"elixir"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nl">"output"</span><span class="p">:</span><span class="w"> </span><span class="s2">"out/elixir"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nl">"test"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"base_url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://localhost:4000"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"implementations"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nl">"ruby"</span><span class="p">:</span><span class="w"> </span><span class="s2">"bin/test-ruby-client"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"elixir"</span><span class="p">:</span><span class="w"> </span><span class="s2">"bin/test-elixir-client"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<hr />

<h2 id="conformance-testing">Conformance Testing</h2>

<p>The CLI includes a <strong>Universal Conformance Driver</strong> that invokes client implementations and verifies they respond correctly to each command defined in the protocol.</p>

<h3 id="command">Command</h3>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sd <span class="nb">test</span> &lt;language&gt; <span class="o">[</span><span class="nt">--only</span><span class="o">=</span>COMMAND] <span class="o">[</span><span class="nt">--trace</span><span class="o">]</span>
</code></pre></div></div>

<h3 id="example">Example</h3>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sd <span class="nb">test </span>ruby
sd <span class="nb">test </span>elixir <span class="nt">--only</span><span class="o">=</span>TENANTS.GET_LIST
</code></pre></div></div>

<h3 id="expected-behavior">Expected Behavior</h3>

<p>The language-specific implementation must expose a way to:</p>
<ul>
  <li>Receive a request (typically via CLI, TCP, or JSON-RPC)</li>
  <li>Execute the specified protocol command</li>
  <li>Return the result or error in the expected format</li>
</ul>

<p>The CLI will:</p>
<ul>
  <li>Send a request for each command</li>
  <li>Validate the structure, data types, and semantic output</li>
  <li>Mark the test as passed or failed</li>
</ul>

<hr />

<h2 id="protocol-definition-files">Protocol Definition Files</h2>

<p>The SweetDate CLI generates code based on the <strong>SweetDate Implementation Protocol (SDIP)</strong>.<br />
These definitions are stored as JSON files in the project root, organized by protocol version.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>protocol-version-01/
  ├─ calendars.json
  ├─ tenants.json
  ├─ users.json
  └─ events.json
</code></pre></div></div>

<p><strong>Example structure:</strong></p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"TENANTS"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"commands"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
      </span><span class="p">{</span><span class="w">
        </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"GET_LIST"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Returns tenants ordered by name ascending."</span><span class="p">,</span><span class="w">
        </span><span class="nl">"params"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
          </span><span class="nl">"limit"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"integer"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"required"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
            </span><span class="nl">"default"</span><span class="p">:</span><span class="w"> </span><span class="mi">25</span><span class="p">,</span><span class="w">
            </span><span class="nl">"min"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
            </span><span class="nl">"max"</span><span class="p">:</span><span class="w"> </span><span class="mi">100</span><span class="p">,</span><span class="w">
            </span><span class="nl">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Maximum number of items to return."</span><span class="w">
          </span><span class="p">},</span><span class="w">
          </span><span class="nl">"offset"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"integer"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"required"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
            </span><span class="nl">"default"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
            </span><span class="nl">"min"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
            </span><span class="nl">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Number of items to skip."</span><span class="w">
          </span><span class="p">}</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="nl">"response"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
          </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"tenant_list"</span><span class="p">,</span><span class="w">
          </span><span class="nl">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Paginated list of tenants (ordered by name asc)."</span><span class="p">,</span><span class="w">
          </span><span class="nl">"example"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nl">"status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ok"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"result"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
              </span><span class="nl">"tenants"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
                </span><span class="p">{</span><span class="w">
                  </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"t1"</span><span class="p">,</span><span class="w">
                  </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Alpha"</span><span class="p">,</span><span class="w">
                  </span><span class="nl">"account_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"acc-123"</span><span class="p">,</span><span class="w">
                  </span><span class="nl">"inserted_at"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2025-08-18T09:20:00Z"</span><span class="p">,</span><span class="w">
                  </span><span class="nl">"updated_at"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2025-08-19T10:15:00Z"</span><span class="w">
                </span><span class="p">},</span><span class="w">
                </span><span class="p">{</span><span class="w">
                  </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"t2"</span><span class="p">,</span><span class="w">
                  </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Beta"</span><span class="p">,</span><span class="w">
                  </span><span class="nl">"account_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"acc-456"</span><span class="p">,</span><span class="w">
                  </span><span class="nl">"inserted_at"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2025-08-18T11:00:00Z"</span><span class="p">,</span><span class="w">
                  </span><span class="nl">"updated_at"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2025-08-18T11:00:00Z"</span><span class="w">
                </span><span class="p">}</span><span class="w">
              </span><span class="p">],</span><span class="w">
              </span><span class="nl">"limit"</span><span class="p">:</span><span class="w"> </span><span class="mi">25</span><span class="p">,</span><span class="w">
              </span><span class="nl">"offset"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="w">
            </span><span class="p">}</span><span class="w">
          </span><span class="p">},</span><span class="w">
          </span><span class="nl">"error_example"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nl">"error"</span><span class="p">:</span><span class="w"> </span><span class="s2">"invalid"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"details"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
              </span><span class="nl">"limit"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"must be between 1 and 100"</span><span class="p">],</span><span class="w">
              </span><span class="nl">"offset"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"must be &gt;= 0"</span><span class="p">]</span><span class="w">
            </span><span class="p">}</span><span class="w">
          </span><span class="p">}</span><span class="w">
        </span><span class="p">}</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">]</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<hr />

<p>Let me know if you’d like a diagram or dedicated page for the <strong>Conformance Test Protocol</strong> as well.</p>
