<h1 id="universal-conformance-driver">Universal Conformance Driver</h1>

<p>The <strong>Universal Conformance Driver</strong> is a module in the SweetDate CLI that verifies protocol compliance of language-specific implementations. It runs test manifests that describe expected behavior, and delegates test execution to each implementation under test.</p>

<h2 id="purpose">Purpose</h2>

<p>The conformance driver ensures that all language-specific client libraries behave <strong>correctly and consistently</strong> according to the SweetDate Implementation Protocol (SDIP).</p>

<p>It does not test the server itself. Instead, it tests that a client implementation of the protocol can send the correct requests, interpret responses, and handle edge cases as described in the protocol definition.</p>

<hr />

<h2 id="how-it-works">How It Works</h2>

<pre><code class="language-ascii">                ┌────────────────────────────┐
                │   SweetDate CLI Driver     │
                │     (Conformance Layer)    │
                └────────────────────────────┘
                           │
             Reads test manifest JSON
                           ▼
                ┌───────────────────────┐
                │  Language Test Runner │───────┐
                │  (Ruby, Elixir, PHP)  │       │
                └───────────────────────┘       ▼
                     Executes test cases   Validates results
                                               │
                                     Reports Pass/Fail
</code></pre>

<hr />

<h2 id="structure">Structure</h2>

<p>Each test is defined in a <strong>manifest JSON file</strong>, specifying:</p>

<ul>
  <li>The command to be tested (e.g. <code class="language-plaintext highlighter-rouge">CALENDARS.CREATE</code>)</li>
  <li>The parameters to send</li>
  <li>The expected request/response behavior</li>
  <li>Optional edge case checks (e.g. missing params, rate limits)</li>
</ul>

<hr />

<h2 id="configuration">Configuration</h2>

<p>The <code class="language-plaintext highlighter-rouge">sd.config.json</code> file can include a section for conformance testing:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"protocol"</span><span class="p">:</span><span class="w"> </span><span class="s2">"protocol-version-01/protocol.json"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"conformance"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"runner"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ruby"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"runner_path"</span><span class="p">:</span><span class="w"> </span><span class="s2">"out/ruby/test_runner.rb"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"manifest"</span><span class="p">:</span><span class="w"> </span><span class="s2">"tests/protocol_manifest.json"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<hr />

<h2 id="execution">Execution</h2>

<p>To run the conformance tests from the CLI:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sd_cli <span class="nb">test </span>conformance
</code></pre></div></div>

<p>This will:</p>
<ul>
  <li>Load the selected protocol version and manifest</li>
  <li>Delegate test execution to the test runner in the selected language</li>
  <li>Capture and summarize the results in a final test report</li>
</ul>

<hr />

<h2 id="language-specific-runners">Language-Specific Runners</h2>

<p>Each supported language must expose a <code class="language-plaintext highlighter-rouge">test_runner</code> CLI interface that accepts a command name and test parameters, then returns a structured JSON result.</p>

<p><strong>Example Invocation:</strong></p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ruby test_runner.rb <span class="nt">--command</span> CALENDARS.CREATE <span class="nt">--params</span> <span class="s1">'{}'</span>
</code></pre></div></div>

<p><strong>Expected Output (JSON):</strong></p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ok"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"result"</span><span class="p">:</span><span class="w"> </span><span class="s2">"passed"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<hr />

<h2 id="benefits">Benefits</h2>

<ul>
  <li>Detect missing or invalid protocol commands in clients</li>
  <li>Ensure future versions of the protocol don’t break existing clients</li>
  <li>Provide confidence to integrators and end users</li>
</ul>
